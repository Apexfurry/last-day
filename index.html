<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>LAST DAY</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@300;400&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  background:#000;
  color:#fff;
  font-family:'Inter',sans-serif;
  width:100vw;
  height:100vh;
  overflow:hidden;
  display:flex;
  justify-content:center;
  align-items:center;
}
#trigger{
  font-family:'Bebas Neue';
  letter-spacing:.45em;
  font-size:1.2rem;
  cursor:pointer;
  z-index:10;
}
#circle{
  position:fixed;
  inset:0;
  display:flex;
  justify-content:center;
  align-items:center;
  pointer-events:none;
}
.poster{
  position:absolute;
  width:140px;
  height:210px;
  background-size:cover;
  background-position:center;
  box-shadow:0 40px 120px rgba(0,0,0,.95);
  opacity:0;
  pointer-events:auto;
}
#archive{
  position:fixed;
  inset:0;
  padding:10vh 5vw;
  display:none;
  overflow-y:auto;
}
#search-wrap{
  position:fixed;
  top:24px;
  right:24px;
  z-index:300;
  display:flex;
  gap:12px;
}
#search-bar{
  width:0;
  overflow:hidden;
  opacity:0;
  transition:.4s;
}
#search-bar.active{width:220px;opacity:1}
#search-input{
  background:transparent;
  border:none;
  border-bottom:1px solid #333;
  color:#fff;
  outline:none;
}
#search-results{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(140px,1fr));
  gap:20px;
  margin-top:60px;
}
.grid{
  margin-top:100px;
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:4vw;
}
.grid-item{
  aspect-ratio:2/3;
  background-size:cover;
  background-position:center;
  cursor:pointer;
}
#return{
  position:fixed;
  top:30px;
  left:30px;
  font-family:'Bebas Neue';
  letter-spacing:.3em;
  cursor:pointer;
  opacity:0;
  pointer-events:none;
}
</style>
</head>

<body>

<audio id="hoverSound" src="assets/audio/og.mp3"></audio>

<div id="trigger">LAST DAY</div>
<div id="circle"></div>

<div id="archive">
  <div id="search-wrap">
    <div id="search-icon">üîç</div>
    <div id="search-bar">
      <input id="search-input" placeholder="Search movie or series..." />
    </div>
  </div>
  <div id="search-results"></div>
  <div class="grid" id="grid"></div>
</div>

<div id="return">RETURN</div>

<script>
/* ---------- CONFIG ---------- */
const OMDB_KEY="a274b977";
const FALLBACK="https://via.placeholder.com/500x750/000000/FFFFFF?text=NO+POSTER";
const hiRes=u=>u&&u!=="N/A"?u.replace("_SX300","_SX700"):FALLBACK;

/* ---------- DOM ---------- */
const trigger=document.getElementById("trigger");
const circle=document.getElementById("circle");
const archive=document.getElementById("archive");
const grid=document.getElementById("grid");
const ret=document.getElementById("return");
const hoverSound=document.getElementById("hoverSound");
const searchIcon=document.getElementById("search-icon");
const searchBar=document.getElementById("search-bar");
const searchInput=document.getElementById("search-input");
const searchResults=document.getElementById("search-results");

/* ---------- STATE ---------- */
let state=0;
let circleItems=[];
let savedMovies=JSON.parse(localStorage.getItem("savedMovies"))||[];

/* ---------- CIRCLE ---------- */
const RADIUS=260;
function buildCircle(){
  circle.innerHTML="";
  circleItems=[];
  if(savedMovies.length===0) return;

  savedMovies.forEach((m,i)=>{
    const el=document.createElement("div");
    el.className="poster";
    el.style.backgroundImage=`url(${hiRes(m.Poster)})`;
    circle.appendChild(el);
    circleItems.push(el);

    const a=i/savedMovies.length*Math.PI*2-Math.PI/2;
    const x=Math.cos(a)*RADIUS;
    const y=Math.sin(a)*RADIUS;

    gsap.set(el,{x:0,y:0,scale:.8,opacity:0});
    gsap.to(el,{x,y,scale:1,opacity:1,duration:1.2,delay:i*.08});

    el.onmouseenter=()=>{
      hoverSound.currentTime=0;
      hoverSound.play();
      circleItems.forEach(p=>p!==el&&gsap.to(p,{opacity:0}));
      gsap.to(el,{x:x*1.15,y:y*1.15,scale:1.12});
    };
    el.onmouseleave=()=>{
      circleItems.forEach(p=>gsap.to(p,{opacity:1}));
      gsap.to(el,{x,y,scale:1});
    };
  });
}

/* ---------- PAGE FLOW ---------- */
trigger.onclick=()=>{
  if(state===0){state=1;buildCircle();}
  else if(state===1) openArchive();
};
function openArchive(){
  state=2;
  trigger.style.display="none";
  gsap.to(circleItems,{opacity:0,scale:0,onComplete:()=>circle.innerHTML=""});
  archive.style.display="block";
  gsap.to(ret,{opacity:1,pointerEvents:"auto"});
  renderSaved();
}

/* ---------- SEARCH ---------- */
searchIcon.onclick=()=>{
  searchBar.classList.toggle("active");
  searchInput.focus();
};
let timer;
searchInput.oninput=()=>{
  clearTimeout(timer);
  timer=setTimeout(searchMovies,350);
};
function classify(q){return q.length<=3;}
async function exactLookup(title){
  const years=["","2023","2022","2021","2020","2019","2018","2017","2010","2000","1990"];
  for(const y of years){
    const r=await fetch(`https://www.omdbapi.com/?apikey=${OMDB_KEY}&t=${encodeURIComponent(title)}${y?`&y=${y}`:""}`);
    const d=await r.json();
    if(d.Response!=="False") return d;
  }
  return null;
}
function renderResult(m){
  const el=document.createElement("div");
  el.className="grid-item";
  el.style.backgroundImage=`url(${hiRes(m.Poster)})`;
  el.onclick=()=>saveMovie(m);
  searchResults.appendChild(el);
}
async function searchMovies(){
  const q=searchInput.value.trim().toLowerCase();
  searchResults.innerHTML="";
  if(!q) return;

  if(classify(q)){
    const exact=await exactLookup(q);
    if(exact){renderResult(exact);return;}
  }

  const r=await fetch(`https://www.omdbapi.com/?apikey=${OMDB_KEY}&s=${encodeURIComponent(q)}`);
  const d=await r.json();
  if(d.Response==="False") return;
  d.Search.forEach(renderResult);
}

/* ---------- GRID ---------- */
function enableGridFocus(){
  const items=document.querySelectorAll(".grid-item");
  items.forEach(i=>{
    i.onmouseenter=()=>{
      items.forEach(o=>o!==i&&gsap.to(o,{opacity:0}));
      gsap.to(i,{scale:1.08});
    };
    i.onmouseleave=()=>{
      items.forEach(o=>gsap.to(o,{opacity:1}));
      gsap.to(i,{scale:1});
    };
  });
}
function renderSaved(){
  grid.innerHTML="";
  savedMovies.forEach(m=>{
    const el=document.createElement("div");
    el.className="grid-item";
    el.style.backgroundImage=`url(${hiRes(m.Poster)})`;
    el.oncontextmenu=e=>{e.preventDefault();removeMovie(m.imdbID);};
    grid.appendChild(el);
  });
  enableGridFocus();
}
function saveMovie(movie){
  if(savedMovies.find(m=>m.imdbID===movie.imdbID)) return;
  savedMovies.push(movie);
  localStorage.setItem("savedMovies",JSON.stringify(savedMovies));
  renderSaved();
}
function removeMovie(id){
  savedMovies=savedMovies.filter(m=>m.imdbID!==id);
  localStorage.setItem("savedMovies",JSON.stringify(savedMovies));
  renderSaved();
}

/* ---------- RETURN ---------- */
ret.onclick=()=>{
  archive.style.display="none";
  trigger.style.display="block";
  gsap.to(ret,{opacity:0,pointerEvents:"none"});
  state=1;
  buildCircle();
};
</script>

</body>
</html>
